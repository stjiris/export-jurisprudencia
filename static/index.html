<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Importar/Exportar Jurisprudencia</title>
</head>
<body>
    <form method="post" enctype="multipart/form-data" action="./import">
        <input type="file" name="file" required pattern="*.xlsx">
        <input type="text" name="code" required>
        <button type="submit">Atualizar Jurisiprudencia com este ficheiro.</button>
    </form>
    <p>Estado: <b id="state"></b> <a href="state.html">Ver detalhes</a></p>
    <table border="1">
        <thead>
            <tr>
                <th>Ficheiro Importado</th>
                <th>Ficheiro Aggregações Exportado</th>
                <th>Ficheiro Índices Exportado</th>
            </tr>
        </thead>
        <tbody id="files"></tbody>
    </table>
    <script>
        fetch("./state").then( r => r.json() ).then( json => state.textContent = json.state)
        fetch("./files").then( r => r.json()).then( json => {
            let imported = json.imported;
            let aggs = json.exported.filter(f => f.indexOf("aggs") != -1);
            let indices = json.exported.filter(f => f.indexOf("indices") != -1)
            let tbody = document.getElementById("files");
            for(let i = 0; i < Math.max(imported.length, aggs.length, indices.length); i++){
                let row = tbody.insertRow();
                let c1 = row.insertCell();
                c1.innerHTML = imported[i] ? `<a href="./imports/${imported[i]}">${imported[i]}</a>` : "n.d."
                let c2 = row.insertCell();
                c2.innerHTML = aggs[i] ? `<a href="./exports/${aggs[i]}">${aggs[i]}</a>` : "n.d."
                let c3 = row.insertCell();
                c3.innerHTML = indices[i] ? `<a href="./exports/${indices[i]}">${indices[i]}</a>` : "n.d."
            }
        })
    </script>
</body>
</html>